### 条件节点

审批王里的条件节点的目标是智能选择审批路径。

如费用报销流程中，根据报销金额的不同，审批步骤/审批人也会有所不同，判断规则是报销金额是否大于10000，如果是的话，申请单提交给总经理审批后再交给财务经理，如果不是的话，申请单直接交给财务经理审批即可。

这里的“报销金额判断”就是一个典型的“条件”节点。条件公式为：{报销金额合计}>=10000 和 {报销金额合计}<10000，两个公式分别连线到“总经理审批”节点和“财务经理”审批节点。

这样，当用户提交申请单后，系统会根据本次申请的实际金额作判断，决定下一步执行“总经理审批”还是是“财务经理审批”。 

- #### 条件节点注意事项：
 - 所有的条件分支不能相互重叠。如上例，假设两个条件分支为“报销金额合计>=10000”和“报销金额合计<＝10000”，则重叠了金额为10000的情况，如果“报销金额合计＝10000”，则系统无法判断走分支1还是分支2。
 - 条件分支应能涵盖所有的情况。如上例，假设两个条件分支为“报销金额合计>10000”和“报销金额合计<10000”，则遗漏了金额为10000的情况，如果“报销金额合计＝10000”，则系统也无法判断走分支1还是分支2。

- #### 设置上述条件节点的具体步骤如下：
 - 添加条件步骤。拖动属性面板画图设置的的“条件”至左侧界面。
 - 在条件节点的属性区域对条件步骤命名，这里将其命名为“报销金额合计是否大于10000”。
 - 左侧点击提交节点右上角的“+”，添加两根连线。
 - 编辑连线一的条件。左侧点击连线一，右侧的属性区域下，设置连线名称与连线条件。这里设置连线条件为“{报销金额合计}>=10000”。具体为什么要这么设置条件，请参考“流程条件的编写规则”。
 - 编辑另一条连线条件。设置连线条件为“{采购金额合计}<10000”。 具体为什么要这么设置条件，请参考“流程条件的编写规则”。

- #### 条件编写有以下基本规则：

 - 条件中引用字段需使用字段名+{}，如：{请假天数}；
 - 条件中使用的符号必须是半角符号；
 - 条件中嵌套条件时，用()；
 - 条件中可以使用公式和函数。
 
- #### 条件中的判断项目，包括：
 - 数值类型常量：直接使用数值，如：1000
 - 字符类型常量：使用“"”(注意是半角)将字符串扩起来，如："北京"
 - 表单字段变量：使用“{”和“}” (注意都是半角)将字段名扩起来，如：{请假天数}
 - 基于提交人的系统变量：包括姓名、角色、部门等
 - 提交人的所在部门（全路径）： {applicant.organization.fullname}
 - 提交人的所在部门（最底层部门名）： {applicant.organization.name}
 - 提交人的角色名： {applicant.roles} 
 - 提交人的姓名：{applicant.name} 
 - 基于姓名表单字段的系统变量：包括姓名、角色、部门等
    
     “报销人”的所在部门（全路径）： {报销人}.organization.fullname 

     “报销人”的所在部门（最底层部门名）： {报销人}.organization.name 
  
     “报销人”的角色名： {报销人}.roles
  
     “报销人”的姓名： {报销人}.name
 - 基于数值字段的函数：
     加：{字段名1}+{字段名2}

     减：{字段名1}-{字段名2}

     乘：{单价}*{数量}

     除：{总金额}/{数量}
 - 基于表格（子表）中的数值字段的函数：
     合计:sum({费用})
  
     平均值：average({费用})

     计数：count({物品})

     最大值：max({费用})

     最小值：min({费用})
 
 - 统计多选项中有几项被选中了：length({交通工具})
 
 - 数值类型的判断，允许使用以下符号：

     = ：等于，如：{借款金额}=1000

     >：大于，如：{借款金额}>1000

     < ：小于，如：{借款金额}<1000

     >= ：大于等于，如：sum({报销费用合计})>=1000

     <= 小于等于，如：max({单笔费用金额})<=1000
  
     != ：不等于，如：sum({借款金额})!=1000

     <> ：不等于，如：sum({借款金额})<>1000

 - 字符类型的判断，允许使用以下符号/函数：

     =：是，如：{项目}="北京"
  
     !=：非，如：{项目}!="北京"

     _.contains()：包含,如：_.contains({applicant.roles},'部门经理') 提交人是部门经理。
  
  请注意：由于一个人可能承担了多个审批岗位，所以应该用_.contains（包含）来判断，而不能用“=”。
 
 - 一个条件判断如果不够，可以多个条件判断组合使用。允许组合关系包括：

     ||：或，如：{借款金额}<1000 ||{项目}="北京"

     &&： 与，如：{借款金额}<1000 &&{项目}="北京"

     !:  非，如：!({借款金额}<1000)
 

- #### 条件判断的实际运用
 - 对数值进行判断

 如请假天数大于三天需要总经理审批，小于等于三天只需要人事部审核。这类型的判断还用于金额等。
 - 对提交人进行判断
 
 如提交人是Tony则由总经理直接审批，若不是则需要部门经理审批。如何取得提交人是谁，则通过公式的编写。
 - 对提交人岗位进行判断
 
 如当提交人是部门员工，则由部门经理审批；而当提交人是部门经理，则由总经理审批。条件中，首先要使用系统提供的函数来获取相关的信息。如：{applicant.roles}获取提交人的角色。
 - 组合条件进行判断

 运用或、与的关系进行多个条件组合判断。如是部门经理或者是办公室人员由办公室审批，而不是部门经理且不是办公室人员的由部门经理审批。

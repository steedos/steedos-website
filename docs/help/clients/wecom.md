---
title: 企业微信集成
---

## 为什么集成企业微信

华炎魔方几乎没有考虑在手机浏览器上的使用效果。如果您希望使用手机来访问华炎魔方，推荐安装和使用我们的 [手机客户端](/help/clients/mobile)，您也可以考虑把华炎魔方集成到企业微信，以便在企业微信客户端中使用华炎魔方。

### 单点登录

华炎魔方集成到企业微信后，只要使用企业微信账户登录企业微信客户端，即可在企业微信中直接使用华炎魔方，而不需要再次使用华炎魔方账户来登录使用。

### 消息推送

华炎魔方集成到企业微信后，当其绑定的华炎魔方账户有通知消息时，企业微信会弹出消息提醒，可点击该消息直接进入华炎魔方查看或处理相关消息。

### 支持各种客户端

得益于企业微信本身支持各种手机、平板电脑、PC电脑等，华炎魔方集成进去后也可以在这些客户端上直接使用。

## 如何集成企业微信

### 准备工作

在集成企业微信前，请确保您的华炎魔方项目已经绑定到某个可通过互联网访问进入的域名地址，只能通过局域网IP或外网IP地址访问的华炎魔方项目是不可以集成到企业微信的，以下说明均假定您的项目已经绑定到域名地址`https://www.test-qywx.com`。

### 创建企业微信应用

请注册企业微信，并在企业微信后台（应用管理->应用）创建一个应用，以下说明都假设这里创建了一个名为“华炎魔方合同”的应用。

### 设置企业微信应用主页

请在企业微信后台，进入“应用管理->应用”，并点击进入刚刚创建的“华炎魔方合同”应用。在“功能”栏中找到“工作台应用主页”并点击其下方的“设置应用主页”按钮来设置应用主页。

这里需要输入的是您的华炎魔方项目的域名访问地址加上`/api/qiyeweixin/mainpage`后缀，比如`https://www.test-qywx.com/api/qiyeweixin/mainpage`。

:::note 提示
华炎魔方集成企业微信的单点登录功能使用的就是`/api/qiyeweixin/mainpage`这个路径指向的接口。
:::

### 设置可信域名

请在企业微信后台，进入“应用管理->应用”，并点击进入刚刚创建的“华炎魔方合同”应用。在“开发者接口”栏中找到“网页授权及JS-SDK”并点击其下方的“设置可信域名”按钮来设置可信域名。

***可作为应用OAuth2.0网页授权功能的回调域名***：直接输入华炎魔方项目的域名访问地址即可，比如`www.test-qywx.com`。

***可调用JS-SDK、跳转小程序的可信域名（最多10个，需完成域名校验）***：直接输入华炎魔方项目的域名访问地址即可，比如`www.test-qywx.com`。

***域名归属验证***：点击此处的“申请校验域名”链接并按提示操作，底下的“用于OAuth2.0回调的可信域名是否校验”勾选框也必须勾选。

:::note 提示
要集成企业微信到华炎魔方，必须完成这里提到的“域名归属验证”，不排除其不支持`http`域名地址，推荐使用`https`域名地址。
:::

### 添加企业微信插件

把企业微信集成到华炎魔方之前，请先在华炎魔方项目中安装和启用插件 [@steedos/plugin-qywx](https://www.npmjs.com/package/@steedos/plugin-qywx)。

如何安装和启用插件请参考：[华炎魔方插件](/plugins/index)。

### 绑定企业微信应用

在启用企业微信插件之后，华炎魔方管理员可以在“设置->公司设置->公司”界面看到新加了一栏“企业微信”，完善这些信息即可把企业微信应用绑定到华炎魔方中。

- 企业ID(CorpId)：在企业微信后台，“我的企业->企业信息”界面可以查看和复制该ID值。
- 应用ID(AgentID)：在企业微信后台，“应用管理->华炎魔方合同”界面可以查看和复制该ID值。
- 应用密钥(Secret)：在企业微信后台，“应用管理->华炎魔方合同”界面可以查看和复制该ID值。

## 在企业微信中使用华炎魔方

把企业微信集成到华炎魔方之后，还需要在华炎魔方中配置每个用户的“企业微信账号”才能正常在企业微信中使用华炎魔方。

系统管理员可以通知需要在企业微信中使用华炎魔方的用户前往企业微信的通讯录中查找自己的“企业微信账号”，并把它复制下来，然后在华炎魔方的“设置->个人账户设置->我的资料”界面上编辑保存其“企业微信账号”信息；也可以统一由系统管理员在华炎魔方“设置->公司设置->用户”界面上维护每个用户在企业微信通讯录上的“企业微信账号”信息。

以上所有就绪后，华炎魔方用户只要登录企业微信账户就可以在企业微信客户端上无缝使用华炎魔方服务了。

### 工作台

如果企业微信上集成了上述创建的“华炎魔方合同”项目，那么只要在手机或PC客户端登录了企业微信，就可以在其“工作台”栏上看到“华炎魔方合同”这个应用，直接点击即可进入应用主页。

### 消息

如果企业微信上集成了上述创建的“华炎魔方合同”项目，那么只要在手机或PC客户端登录了企业微信，当其绑定的华炎魔方账户上有推送通知消息时，企业微信客户端会主动通知用户收到推送通知，也可以在其“消息”栏上直接看到来自华炎魔方的消息列表。

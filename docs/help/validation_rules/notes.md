---
title: 编写验证规则的提示
---

## 编写验证规则的提示

- 验证规则是在记录被保存前触发的，如果验证不通过会阻止记录保存。
- 请考虑可能会使记录无法通过验证的所有设置，比如字段更新、隐藏字段、公式及汇总字段。
- 务必小心，不要为同一个字段创建多个冲突的验证规则，否则用户将无法保存记录。
- 设计不当的验证规则会妨碍用户保存有效数据。启用验证规则之前，确保您已充分测试该验证规则。
- 在验证公式中引用相关字段时，确保已部署了这些对象及字段。
- 验证规则中公式应该按返回值为布尔类型来编制，返回值为TRUE才验证不通过。

- 不必使用 IF 函数来开始验证规则公式。只需使用布尔错误条件表达式即可。例如：
     正确：CloseDate < TODAY() 
     错误：IF(CloseDate < TODAY(), TRUE, FALSE)

- 请记住，当验证规则包含 BEGINS 或 CONTAINS 函数时，它会将空白字段处理为有效字段。例如，如果您的验证规则要测试资产序列号是否以“3”开始，则序列号为空白的所有资产都将视为有效。
- 使用验证规则时需要注意字段值为空的情况，请使用 ISBLANK 函数判断字段是否为空。例如，要验证自定义字段不为空且不能等于1，请使用下面的验证规则以在该字段为空白或1时显示错误：OR (ISBLANK (field__c), field__c=1)
   
## 编写验证规则错误消息的提示

 - **提供操作指导。** “无效条目”这样的错误消息并没有告诉用户哪类条目有效。编写一些更为具体的消息，例如“结束日期必须晚于今天”。
 - **始终包括字段标签。** 用户可能不知道哪个字段验证失败，尤其当错误消息不是出现在字段旁边而是出现在右上角时。
 - 如果需要多语言提示错误信息，可能需要翻译错误消息。您可以在错误信息中直接输入对应的i18n翻译key，比如email_format_error，这会显示错误信息“邮件格式错误”。

## 验证规则注意事项

在实施验证规则前，请先了解以下注意事项。
- 当一条验证规则失败时，华炎魔方不会继续对该字段或页面中的其他字段检查其他验证规则。
- 如果工作流规则、批准过程等配置了字段更新，且要更新的字段上正好配置了验证规则的话，当触发字段更新时，不会触发相关字段的验证规则。
- 由于公式字段中的公式是在记录被保存(afterInsert/afterUpdate)后才触发的，所以如果验证规则中引用了公式字段，有可能与设计验证规则的初衷不同，因为触发验证规则时其中引用的公式字段值可能是之前已经在数据库中保存过的老值，而且在公式字段本身值变更时不会再次触发执行验证规则。
- 与公式字段一样，如果验证规则中引用了累计汇总字段，当汇总字段值在变更时也不会触发执行验证规则，比如主记录有一个验证规则，要求累计汇总字段值必须小于100。如果用户对相关子记录的更改将输入超过 100 的值，希望用户无法保存该子表记录，实际上子记录变更时主记录的验证规则是不会被触发的，要实现这个需求，通常的做法是把验证规则配置在子表而不是主表中，类似：lookup_mater_object_field.summary_value + current_value >= 100。
